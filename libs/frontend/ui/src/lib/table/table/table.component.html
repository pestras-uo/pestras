<div class="card h-fit">
  <div class="card-header">
    <div *ngIf="config.search" class="fc fc-round w-8">
      <i size="small" puiIcon="search"></i>
      <input
        type="search"
        [placeholder]="searchPlaceholder"
        [formControl]="searchControl"
      />
    </div>

    <ng-content select=".action-start"></ng-content>

    <div class="grow"></div>

    <ng-content select=".action"></ng-content>
  </div>

  <div class="card-body overflow-x-auto">
    <ng-container *ngIf="!filtered || filtered.length === 0">
      <ng-content></ng-content>
    </ng-container>

    <table *ngIf="filtered && filtered.length > 0">
      <thead>
        <tr>
          <th *ngIf="config.indexing" class="index-col">#</th>

          <ng-container *ngFor="let column of config.columns">
            <th
              *ngIf="!column.hidden"
              [class.cursor-pointer]="config.sort! | arrayInclude : column.key"
              [class.icon-col]="
                column.type === 4 || column.type === 5 || column.type === 7
              "
              [class.date]="column.type === 3"
              (click)="updateSort(column)"
            >
              <div class="toolbar gap-4">
                <h5 class="weight-8">{{ column.header }}</h5>
                <ng-container *ngIf="sortState$ | async as options">
                  <i
                    *ngIf="options[column.key] === -1"
                    size="tiny"
                    [puiIcon]="'north'"
                  ></i>
                  <i
                    *ngIf="options[column.key] === 1"
                    size="tiny"
                    [puiIcon]="'south'"
                  ></i>
                </ng-container>
              </div>
            </th>
          </ng-container>

          <th *ngIf="config.indicator" class="icon-col">
            {{ config.indicator.header }}
          </th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let item of filtered; let i = index">
          <tr
            #row
            class="row-hover"
            [class.cursor-pointer]="
              config.rowLink || subTemplate || config.rowPointer
            "
            (click)="rowClicked($event, item, row)"
          >
            <!-- indexing -->
            <td *ngIf="config.indexing" class="index-col">
              {{
                (pageControl.value - 1) * (config.pagination || 1) + i + 1
                  | number : "3.0"
              }}
            </td>

            <!-- placing columns -->
            <ng-container *ngFor="let column of config.columns">
              <td
                *ngIf="!column.hidden"
                [class]="column.cssClass"
                [title]="item | rowTitle : config.hint"
              >
                <ng-container *ngIf="!(item | skipValue : column)">
                  <!-- Prefix -->
                  <span *ngIf="column.prefix">{{ column.prefix }}</span>
                  <ng-container [ngSwitch]="column.type">
                    <!-- List Type -->
                    <ng-container *ngSwitchCase="2">
                      <span
                        *ngFor="let value of item | listFieldValue : column"
                        class="badge badge-primary-overlay mie-1"
                        >{{ value }}</span
                      >
                    </ng-container>

                    <!-- Action Type -->
                    <button
                      *ngSwitchCase="4"
                      [class]="
                        'btn-small btn-icon btn-round ' + column.actionClass ||
                        ''
                      "
                      [class.btn-icon]="column.icon"
                      (click)="actionClicked($event, column.key, item)"
                    >
                      <i size="small" [puiIcon]="column.icon!"></i>
                    </button>

                    <!-- Boolean Type -->
                    <ng-container *ngSwitchCase="5">
                      <i
                        size="small"
                        [puiIcon]="
                          (item | boolFieldValue : column) ? 'check' : 'close'
                        "
                      ></i>
                    </ng-container>

                    <!-- Date type -->
                    <span *ngSwitchCase="3" class="success bold">{{
                      item | dateFieldValue : column | date
                    }}</span>

                    <!-- Number Type -->
                    <span *ngSwitchCase="1" class="primary bold">
                      <ng-container *ngIf="column.isAmount">
                        {{ item | numberFieldValue : column | number : "1.0-2" }}
                      </ng-container>
                      <ng-container *ngIf="!column.isAmount">
                        {{ item | numberFieldValue : column }}
                      </ng-container>
                    </span>

                    <!-- template Type -->
                    <span *ngSwitchCase="6">
                      <ng-container
                        *ngIf="templates[column.template ?? column.key] as tmp"
                        [ngTemplateOutlet]="tmp"
                        [ngTemplateOutletContext]="{
                          key: column.key,
                          item: item
                        }"
                      ></ng-container>
                    </span>

                    <!-- location type -->
                    <a
                      *ngSwitchCase="7"
                      [class]="
                        'btn btn-primary btn-small btn-icon btn-round ' +
                          column.actionClass || ''
                      "
                      [class.btn-icon]="column.icon"
                      [href]="item | googleMapLink : column"
                      target="_blank"
                    >
                      <i size="small" puiIcon="location_on"></i>
                    </a>

                    <!-- String Type -->
                    <span *ngSwitchDefault langClass>{{
                      item | stringFieldValue : column
                    }}</span>
                  </ng-container>

                  <!-- suffix -->
                  <span *ngIf="column.suffix">{{ column.suffix }}</span>
                </ng-container>
              </td>
            </ng-container>

            <td *ngIf="config.indicator">
              <pui-indicator
                [levels]="config.indicator.levels"
                size="small"
                [value]="item[config.indicator.key]"
              ></pui-indicator>
            </td>
          </tr>

          <tr class="sub-content" *ngIf="subTemplate">
            <td *ngIf="config.indexing"></td>
            <td class="p-0" [attr.colspan]="config.columns.length">
              <ng-container
                *ngTemplateOutlet="subTemplate; context: { data: item }"
              ></ng-container>
            </td>
          </tr>
        </ng-container>
      </tbody>

      <!-- <tfoot *ngIf="footer && config.footers">
        <tr *ngFor="let item of footer; let i = index">

          <th>{{config.footers[i].name}}</th>

          <th *ngFor="let column of config.footers[i].columns">

            <span *ngIf="column.prefix">{{column.prefix}}</span>
            <ng-container [ngSwitch]="column.type">

              Boolean Type 
              <ng-container *ngSwitchCase="5">
                <i size="small" [puiIcon]="(item | boolFieldValue: column) ? 'check' : 'close'"></i>
              </ng-container>

              Date type 
              <span *ngSwitchCase="3" class="success bold">{{item | dateFieldValue: column | date}}</span>

              Number Type 
              <span *ngSwitchCase="1" class="primary bold">
                {{item | numberFieldValue: column | number:'1.0-2'}}
              </span>

              String Type 
              <span *ngSwitchDefault langClass>{{item | stringFieldValue: column}}</span>

            </ng-container>

          </th>

        </tr>
      </tfoot> -->
    </table>
  </div>

  <div
    class="card-footer justify-content-center"
    *ngIf="config.pagination && list && list.length > 0"
  >
    <div class="fc flex-inline w-4 mbe-0">
      <button
        class="btn-tiny btn-icon"
        [disabled]="pageControl.value === 1"
        (click)="prevPage()"
      >
        <i
          size="small"
          [puiIcon]="('rtl' | isDir) ? 'navigate_next' : 'navigate_before'"
        ></i>
      </button>

      <select id="table-page" class="minw-1" [formControl]="pageControl">
        <option *ngFor="let num of pagesSeq" [value]="num">{{ num }}</option>
      </select>

      <button
        class="btn-tiny btn-icon"
        [disabled]="pageControl.value === pagesCount"
        (click)="nextPage()"
      >
        <i
          size="small"
          [puiIcon]="('rtl' | isDir) ? 'navigate_before' : 'navigate_next'"
        ></i>
      </button>
    </div>
  </div>
</div>
